<!DOCTYPE html>
<html>
  <head>
    <title>Data Pasien</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <h2>Pasien</h2>

    <button
      type="button"
      class="btn btn-primary"
      data-bs-toggle="modal"
      data-bs-target="#pasienModal"
    >
      Tambah
    </button>

    <table id="table-data" class="table table-sm">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nama</th>
          <th>Alamat</th>
          <th>Jenis Kelamin</th>
          <th>Tanggal Lahir</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="modal fade" id="pasienModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Add Data</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="myForm">
              <div class="mb-3">
                <label for="nama" class="form-label">Nama</label>
                <input type="text" class="form-control" id="nama" name="nama" />
              </div>
              <div class="mb-3">
                <label for="alamat" class="form-label">Alamat</label>
                <input
                  type="text"
                  class="form-control"
                  id="alamat"
                  name="alamat"
                />
              </div>
              <div class="mb-3">
                <label for="jenis_kelamin" class="form-label"
                  >Jenis Kelamin</label
                >
                <select
                  class="form-select"
                  id="jenis_kelamin"
                  name="jenis_kelamin"
                >
                  <option value="laki-laki">Laki-laki</option>
                  <option value="perempuan">Perempuan</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="tanggal_lahir" class="form-label"
                  >Tanggal Lahir</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="tanggal_lahir"
                  name="tanggal_lahir"
                />
              </div>
              <button type="submit" class="btn btn-primary">Submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      const url = "http://localhost:1337/api/pasiens";
      fetch(url)
        .then((response) => response.json())
        .then((data) => {
          const table = document.querySelector("#table-data tbody");
          data.data.forEach((pasien) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${pasien.id}</td>
              <td>${pasien.attributes.nama}</td>
              <td>${pasien.attributes.alamat}</td>
              <td>${pasien.attributes.jenis_kelamin}</td>
              <td>${pasien.attributes.tanggal_lahir}</td>
            `;
            table.appendChild(row);
          });
        })
        .catch((error) => console.error(error));

      const form = document.querySelector("#myForm");
      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const data = {
          nama: form.nama.value,
          alamat: form.alamat.value,
          jenis_kelamin: form.jenis_kelamin.value,
          tanggal_lahir: form.tanggal_lahir.value,
        };

        fetch("http://localhost:1337/api/pasiens", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ data }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            location.reload();
          });
      });
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
